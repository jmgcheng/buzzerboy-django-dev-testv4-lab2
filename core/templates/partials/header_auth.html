{% load i18n %}
{% load static %}
<div class="topbar-custom">
    <div class="container-fluid">
        <div class="d-flex justify-content-between">
            <ul class="list-unstyled topnav-menu mb-0 d-flex align-items-center">
                <li>
                    <button class="button-toggle-menu nav-link">
                        <i data-feather="menu" class="noti-icon"></i>
                    </button>
                </li>
            </ul>

            {% if user.is_authenticated %}
                <ul class="list-unstyled topnav-menu mb-0 d-flex align-items-center">
                    <li class="dropdown notification-list topbar-dropdown">
                        <a class="nav-link dropdown-toggle nav-user me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                            <img src="{% static 'assets/images/users/user-11.jpg' %}" alt="user-image" class="rounded-circle">
                            <span class="pro-user-name ms-1">
                                {{user.email}} <i class="mdi mdi-chevron-down"></i> 
                            </span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end profile-dropdown ">

                            {% with profiles=request.user.profiles.all %}
                            {% if profiles|length > 1 %}
                                <div class="dropdown-header noti-title">
                                    <h6 class="text-overflow m-0">{% translate "Switch to" %}:</h6>
                                </div>
                                {% for profile in profiles %}
                                {% if request.session.active_profile_id != profile.id %}
                                    <a class="dropdown-item" href="{% url 'switch-profile' profile.pk %}?next={{ request.path|urlencode }}">
                                    <i class="mdi mdi-account-circle-outline fs-16 align-middle"></i>
                                    <span>{{ profile }}</span>
                                    </a>
                                {% else %}
                                    <a class="dropdown-item disabled text-muted" href="#">
                                    <i class="mdi mdi-account-circle-outline fs-16 align-middle"></i>
                                    <span>{{ profile }} ({% translate "current" %})</span>
                                    </a>
                                {% endif %}
                                {% endfor %}
                                <hr>
                            {% endif %}
                            {% endwith %}    

                            <!-- Current Profile 
                                    using account/context_processors.py for data to be easily available
                            -->
                            {% if active_profile %}
                            <a href="{% url 'profile' %}" class="dropdown-item notify-item">
                                <i class="mdi mdi-account-circle-outline fs-16 align-middle"></i>
                                <span>{% translate "Profile" %}: {{ active_profile }}</span>
                            </a>
                            {% else %}
                            <a href="{% url 'profile' %}" class="dropdown-item notify-item">
                                <i class="mdi mdi-account-circle-outline fs-16 align-middle"></i>
                                <span>{% translate "Profile" %}</span>
                            </a>
                            {% endif %}


                            <div class="dropdown-divider"></div>

                            <!-- item-->
                            <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item notify-item">
                                <i class="mdi mdi-location-exit fs-16 align-middle"></i>
                                <span>{% translate "Logout" %}</span>
                            </button>
                            </form>

                        </div>
                    </li>

                </ul>

            {% endif %}


        </div>

    </div>
    
</div>